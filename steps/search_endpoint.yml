id: search_endpoint
learningObjectives: 
- Creating an API endpoint 
hints:
- Glad you asked! Are you aware that our backend already supports some filtering options (for example, filter by tag)? You can add another filter by term.
- Our product manager insists that partial matches, not only exact matches, must be returned by the query. 
startFlow:
  do:
  - actionId: bot_message
    params:
      person: head-of-rd
      messages:
      - text: So, here‚Äôs the thing
        delay: 1500
      - text: We‚Äôve been getting complaints about the way our marketplace is built. Things like ‚ÄúHow am I supposed to find anything when it seems like every page is devoted to a Squirrel picnic desk!‚Äù (üòç) or ‚ÄúEverything is so messy, it almost looks like you‚Äôre just selling a bunch of random stuff‚Äù. You know, the usual.
        delay: 3000
      - text: I know we should follow the protocol and ignore them, but Eve, our product manager, is a bit worried‚Äî so :instruction[we‚Äôve been asked to add a search option to the marketplace.] Or, more precisely, I was asked to ask you.
        delay: 2300
      - text: "**_Consider yourself asked!_**"
        delay: 9000
      - text: But, before we implement the full UI, we first need to :instruction[**add product filtering support to our API.**] In other words, when retrieving a list of items using a GET request, there should be an option to :instruction[**add a query filter called ‚Äútitle‚Äù**], so that once we call this endpoint - the backend will show all the relevant items, :instruction[**whose title `contains` the same title query**].
        delay: 1200
      - text: You‚Äôre not being timed on this, so I‚Äôm totally not starting a timer right now, just don‚Äôt forget to **send a PR when you‚Äôre done.**
        delay: 4000
trigger:
  type: github_pr_lifecycle_status
  flowNode:
    switch:
      key: ${eventType}
      cases:
        github_pr_opened:
          do:      
          - actionId: github_pr_comment
            params:
              person: head-of-rd
              message: Lovely. Let me take a look.
              
          - actionId: bot_message
            params:
              person: head-of-rd
              messages:
              - text: Lovely. Let me take a look.
                delay: 300
        github_pr_workflow_complete_success:
          do:
          - actionId: github_pr_approve
            params:
              person: head-of-rd
              message: Looking good! Now we can move on to the UI. \nI'll send you more details on Snack.

          - actionId: bot_message
            params:
              person: head-of-rd
              messages:
              - text: Looking good! Now we can move on to the UI
                delay: 300
        github_pr_workflow_complete_failure:
          do:
          - actionId: github_pr_reject
            params:
              person: head-of-rd
              message: Umm‚Ä¶ something is not quite right, please take another look and try again.

          - actionId: bot_message
            params:
              person: head-of-rd
              messages:
              - text: Umm‚Ä¶ something is not quite right, please take another look and try again.
                delay: 300
        github_pr_merged:
          do:
          - actionId: finish_step


githubActions:
  backend:
    capabilities:
    - axios
    - dotenv
    testFile: "filter.js"
