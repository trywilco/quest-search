id: search_endpoint
hints:
  - Are you sure your local environment is still up? Did you remember running `docker-compose up`?
startFlow:
  if:
    conditions:
      - conditionId: user_has_feature_flag
        params:
          featureFlag: codespaces
    then:
      do:
        - actionId: bot_message
          params:
            person: head-of-rd
            messages:
              - text: "So, here‚Äôs the thing"
                delay: 1500
              - text: "We‚Äôve been getting complaints about the way our [marketplace](https://home.anythink.market/) is built. Things like ‚ÄúHow am I supposed to find anything when it seems like every page is devoted to a Squirrel picnic desk!‚Äù (üòç) or ‚ÄúEverything is so messy, it almost looks like you‚Äôre just selling a bunch of random stuff‚Äù. You know, the usual."
                delay: 3000
              - text: I know we should follow the protocol and ignore them, but Eve, our product manager, is a bit worried‚Äî so :instruction[we‚Äôve been asked to add a search option to the marketplace.] Or, more precisely, I was asked to ask you.
                delay: 2300
              - text: "**_Consider yourself asked!_**"
                delay: 9000
              - text: But, before we do anything, you probably want to see the issue by yourself, in your local environment.
                delay: 1200
              - text: To do that, :instruction[**Go to https://${user.codespace.name}-3001.preview.app.github.dev/register and **create a new user.**]{block=true}
                delay: 4000
    else:
      do:
        - actionId: bot_message
          params:
            person: head-of-rd
            messages:
              - text: 'So, here‚Äôs the thing'
                delay: 1500
              - text: "We‚Äôve been getting complaints about the way our [marketplace](https://home.anythink.market/) is built. Things like ‚ÄúHow am I supposed to find anything when it seems like every page is devoted to a Squirrel picnic desk!‚Äù (üòç) or ‚ÄúEverything is so messy, it almost looks like you‚Äôre just selling a bunch of random stuff‚Äù. You know, the usual."
                delay: 3000
              - text: I know we should follow the protocol and ignore them, but Eve, our product manager, is a bit worried‚Äî so :instruction[we‚Äôve been asked to add a search option to the marketplace.] Or, more precisely, I was asked to ask you.
                delay: 2300
              - text: '**_Consider yourself asked!_**'
                delay: 9000
              - text: But, before we do anything, you probably want to see the issue by yourself, in your local environment.
                delay: 1200
              - text: To do that, :instruction[**Go to http://localhost:3001/register and **create a new user.**]{block=true}
                delay: 4000
trigger:
  type: local_page_load
  flowNode:
    if:
      conditions:
        - conditionId: text_match_regex
          params:
            text: "${path}"
            regex: ^/@*
            flags: i
      then:
        do:
          - actionId: bot_message
            params:
              person: head-of-rd
              messages:
                - text: Amazing, you're part of us, Anythink traders now!
                  delay: 2000
          - actionId: finish_step